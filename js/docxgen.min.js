(function(){var e,t=[].indexOf||function(e){for(var t=0,n=this.length;t<n;t++){if(t in this&&this[t]===e)return t}return-1};Object.size=function(e){var t,n,r;r=0;n=0;for(t in e){r++}return r};window.DocxGen=e=function(){function n(e,t){this.templateVars=t!=null?t:{};this.files={};this.templatedFiles=["word/document.xml","word/footer1.xml","word/footer2.xml","word/footer3.xml","word/header1.xml","word/header2.xml","word/header3.xml"];if(typeof e==="string"){this.load(e)}}var e;e=["gif","jpeg","jpg","emf","png"];n.prototype.load=function(e){var t;t=new JSZip(e);return this.files=t.files};n.prototype.getImageList=function(){var n,r,i,s;s=/[^.]*\.([^.]*)/;r=[];for(i in this.files){n=i.replace(s,"$1");if(t.call(e,n)>=0){r.push({path:i,files:this.files[i]})}}return r};n.prototype.setImage=function(e,t){return this.files[e].data=t};n.prototype.setTemplateVars=function(e){return this.templateVars=e};n.prototype.regexTest=function(e,t){var n,r,i,s,o,u,a,f,l;s=t;for(r=f=0,l=e.length;f<l;r=++f){u=e[r];while(s.match(u.regex)){i=u.regex.exec(s);n=0;a=u.replacement.length;o="";while(n<=a){if(u.replacement.charAt(n)==="$"){n++;r=parseInt(u.replacement.charAt(n));o+=i[r]}else if(u.replacement.charAt(n)==="#"){n++;r=parseInt(u.replacement.charAt(n));o+=this.templateVars[i[r]]}else{o+=u.replacement.charAt(n)}n++}s=s.replace(i[0],o)}}return s};n.prototype.applyTemplateVars=function(){var e,t,n,r,i,s,o;s=this.templatedFiles;o=[];for(r=0,i=s.length;r<i;r++){t=s[r];if(!(this.files[t]!=null)){continue}e=this.files[t].data;n=[{regex:/(<w:t[^>]*>)([^<>]*)\{([a-zA-Z_éèàê0-9]+)\}([^}])/,replacement:"$1$2#3$4"},{regex:/\{([^}]*?)<w:t([^>]*)>([a-zA-Z_éèàê0-9]+)\}/,replacement:"$1<w:t$2>#3"},{regex:/\{([^}]*?)<w:t([^>]*)>([a-zA-Z_éèàê0-9]+)(.*?)<w:t([^>]*)>\}/,replacement:'$1<w:t$2>#3$4<w:t xml:space="preserve">'}];o.push(this.files[t].data=this.regexTest(n,e))}return o};n.prototype.output=function(e){var t,n,r,i,s,o,u;if(e==null){e=true}r=Object.size(this.files);o=new JSZip;t=function(){return document.location.href="data:application/vnd.openxmlformats-officedocument.wordprocessingml.document;base64,"+s};for(i in this.files){n=this.files[i];if(n.name.slice(-1)!=="/"){if((u=n.name.slice(-4))===".png"||u===".emf"||u===".jpg"||u==="jpeg"){o.file(n.name,n.data,n.options)}else{o.file(n.name,n.data)}}}s=o.generate();if(e===true){t()}return s};n.prototype.download=function(e){var t;if(e==null){e="default.docx"}t=this.output(false);return Downloadify.create("downloadify",{filename:function(){return e},data:function(){return t},onCancel:function(){return alert("You have cancelled the saving of this file.")},onError:function(){return alert("You must put something in the File Contents or there will be nothing to save!")},swf:"libs/downloadify/media/downloadify.swf",downloadImage:"libs/downloadify/images/download.png",width:100,height:30,transparent:true,append:false,dataType:"base64"})};return n}()}).call(this)